<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Создание календаря</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #upload-container, #calendar-container {
      display: none;
    }
    #upload-container.active, #calendar-container.active {
      display: block;
    }
    .image-input {
      margin: 10px 0;
    }
    canvas {
      border: 1px solid #000;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="upload-container" class="active">
    <h1>Загрузите 12 изображений для календаря</h1>
    <form id="image-form">
      <!-- Поля для загрузки изображений -->
    </form>
    <button id="next-button" disabled>Дальше</button>
  </div>

  <div id="calendar-container">
    <h1>Создание календаря</h1>
    <canvas id="calendar-preview" width="1280" height="720"></canvas>
    <button id="download-button">Скачать PDF</button>
  </div>

  <script>
    // Основные элементы и переменные
    const uploadContainer = document.getElementById("upload-container");
    const calendarContainer = document.getElementById("calendar-container");
    const imageForm = document.getElementById("image-form");
    const nextButton = document.getElementById("next-button");
    const downloadButton = document.getElementById("download-button");
    const canvas = document.getElementById("calendar-preview");
    const ctx = canvas.getContext("2d");

    const monthNames = [
      "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
      "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"
    ];

    let images = []; // Для хранения изображений

    // Создание полей для загрузки изображений
    for (let i = 0; i < 12; i++) {
      const div = document.createElement("div");
      div.classList.add("image-input");
      div.innerHTML = `
        <label>Месяц ${monthNames[i]}: </label>
        <input type="file" accept="image/*" data-index="${i}" required>
        <span id="status-${i}">Не загружено</span>
      `;
      imageForm.appendChild(div);
    }

    // Обработка загрузки изображений
    imageForm.addEventListener("change", (e) => {
      const input = e.target;
      const index = parseInt(input.dataset.index);

      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (event) => {
          images[index] = event.target.result;
          document.getElementById(`status-${index}`).textContent = "Загружено";

          if (images.length === 12 && !images.includes(undefined)) {
            nextButton.disabled = false;
          }
        };
        reader.readAsDataURL(input.files[0]);
      }
    });

    // Переход к генерации календаря
    nextButton.addEventListener("click", () => {
      uploadContainer.classList.remove("active");
      calendarContainer.classList.add("active");
      generateCalendarPreview(0);
    });

    // Генерация превью для одного месяца
    function generateCalendarPreview(month) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const img = new Image();
      img.src = images[month];
      img.onload = () => {
        ctx.drawImage(img, 0, 0, 520, 720);

        ctx.fillStyle = "#000";
        ctx.font = "30px Arial";
        ctx.fillText(monthNames[month], 600, 50);

        let dayX = 600, dayY = 100;
        for (let i = 1; i <= 31; i++) {
          ctx.fillText(i, dayX, dayY);
          dayX += 50;
          if ((i % 7) === 0) {
            dayX = 600;
            dayY += 50;
          }
        }
      };
    }

    // Скачивание PDF
    downloadButton.addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({
        orientation: "landscape",
        unit: "px",
        format: [1280, 720]
      });

      images.forEach((imgSrc, index) => {
        pdf.setFont("Arial");
        pdf.setFontSize(30);

        const img = new Image();
        img.src = imgSrc;
        pdf.addImage(imgSrc, "JPEG", 0, 0, 520, 720);

        pdf.text(monthNames[index], 600, 50);

        let dayX = 600, dayY = 100;
        for (let i = 1; i <= 31; i++) {
          pdf.text(`${i}`, dayX, dayY);
          dayX += 50;
          if ((i % 7) === 0) {
            dayX = 600;
            dayY += 50;
          }
        }

        if (index < images.length - 1) pdf.addPage();
      });

      pdf.save("calendar.pdf");
    });
  </script>
</body>
</html>
