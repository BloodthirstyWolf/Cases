<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Создание календаря</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #upload-container, #calendar-container {
      display: none;
    }
    #upload-container.active, #calendar-container.active {
      display: block;
    }
    .image-input {
      margin: 10px 0;
    }
    .image-preview {
      margin: 10px;
      width: 200px;
      height: 200px;
      object-fit: cover;
      border: 1px solid #000;
      margin-bottom: 20px;
    }
    canvas {
      border: 1px solid #000;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="upload-container" class="active">
    <h1>Загрузите 12 изображений для календаря</h1>
    <form id="image-form">
      <!-- Поля для загрузки изображений -->
    </form>
    <button id="next-button" disabled>Дальше</button>
  </div>

  <div id="calendar-container">
    <h1>Создание календаря</h1>
    <div id="image-previews">
      <!-- Здесь будут отображаться загруженные изображения -->
    </div>
    <button id="download-button">Скачать PDF</button>
  </div>

  <script>
    const uploadContainer = document.getElementById("upload-container");
    const calendarContainer = document.getElementById("calendar-container");
    const imageForm = document.getElementById("image-form");
    const nextButton = document.getElementById("next-button");
    const imagePreviews = document.getElementById("image-previews");
    const downloadButton = document.getElementById("download-button");

    let images = [];

    // Создание полей для загрузки изображений
    for (let i = 0; i < 12; i++) {
      const div = document.createElement("div");
      div.classList.add("image-input");
      div.innerHTML = `
        <label>Месяц ${i + 1}: </label>
        <input type="file" accept="image/*" data-index="${i}">
        <span id="status-${i}">Не загружено</span>
      `;
      imageForm.appendChild(div);
    }

    imageForm.addEventListener("change", (e) => {
      const input = e.target;
      const index = parseInt(input.dataset.index);

      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (event) => {
          images[index] = event.target.result;
          document.getElementById(`status-${index}`).textContent = "Загружено";
          updateImagePreviews();
          if (images.length === 12 && !images.includes(undefined)) {
            nextButton.disabled = false;
          }
        };
        reader.readAsDataURL(input.files[0]);
      }
    });

    nextButton.addEventListener("click", () => {
      uploadContainer.classList.remove("active");
      calendarContainer.classList.add("active");
      renderCalendarPreview(0);
    });

    // Обновление отображения загруженных изображений
    function updateImagePreviews() {
      imagePreviews.innerHTML = ''; // очищаем контейнер
      images.forEach((imgSrc, index) => {
        const img = document.createElement("img");
        img.src = imgSrc;
        img.alt = `Месяц ${index + 1}`;
        img.classList.add("image-preview");
        imagePreviews.appendChild(img);
      });
    }

    downloadButton.addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({
        orientation: "landscape",
        unit: "px",
        format: [1280, 720]
      });

      images.forEach((imgSrc, index) => {
        pdf.addImage(imgSrc, "JPEG", 0, 0, 520, 720);

        if (index < images.length - 1) pdf.addPage();
      });

      pdf.save("calendar.pdf");
    });
  </script>
</body>
</html>
