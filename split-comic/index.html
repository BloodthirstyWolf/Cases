<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<title>Comic Splitter 9:16</title>
<style>
  body {
    font-family: sans-serif;
    background: #111;
    color: #eee;
    margin: 0;
    padding: 20px;
  }

  h1 { font-size: 20px; }

  input {
    margin: 10px 0;
  }

  #output {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
  }

  .chunk {
    background: #222;
    padding: 6px;
    border-radius: 6px;
  }

  .chunk img {
    width: 100%;
    display: block;
  }

  .chunk a {
    display: block;
    margin-top: 6px;
    text-align: center;
    color: #9cf;
    text-decoration: none;
    font-size: 14px;
  }

    button {
    background: none;
    color: #9cf;
    border: 1px solid #333;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.4;
    cursor: default;
  }

  button:hover:not(:disabled) {
    border-color: #555;
  }

  input[type="file"] {
  color: #eee;
  background: transparent;
}

input[type="file"]::-webkit-file-upload-button {
  background: #222;
  color: #eee;
  border: 1px solid #333;
  border-radius: 4px;
  padding: 6px 10px;
}


  
</style>
</head>
<body>

<h1>–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä–µ–∑ –∫–æ–º–∏–∫—Å–∞ (‚â• 9:16)</h1>
<input type="file" accept="image/*" id="fileInput" />

<button id="downloadZip" disabled>–°–∫–∞—á–∞—Ç—å –≤—Å—ë (ZIP)</button>
<div id="output"></div>


<script>
const input = document.getElementById('fileInput');
const output = document.getElementById('output');
const downloadZipBtn = document.getElementById('downloadZip');

let zip;
let expectedSlices = 0;
let readySlices = 0;

input.addEventListener('change', () => {
  const file = input.files[0];
  if (!file) return;

  zip = new JSZip();
  output.innerHTML = '';
  downloadZipBtn.disabled = true;
  expectedSlices = 0;
  readySlices = 0;

  const img = new Image();
  img.onload = () => splitImage(img);
  img.src = URL.createObjectURL(file);
});

function splitImage(img) {
  const W = img.naturalWidth;
  const H = img.naturalHeight;
  const minSliceHeight = Math.ceil(W * 16 / 9);

  let y = 0;
  let index = 1;

  // üî¢ —Å–Ω–∞—á–∞–ª–∞ —Å—á–∏—Ç–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç –∫—É—Å–∫–æ–≤
  while (y < H) {
    expectedSlices++;
    y += minSliceHeight;
  }

  // üîÅ —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª—å–Ω–æ —Ä–µ–∂–µ–º
  y = 0;
  index = 1;

  while (y < H) {
    const sliceHeight = Math.min(minSliceHeight, H - y);

    const canvas = document.createElement('canvas');
    canvas.width = W;
    canvas.height = sliceHeight;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, y, W, sliceHeight, 0, 0, W, sliceHeight);

    const pad = String(index).padStart(2, '0');
    const filename = `chunk_${pad}.png`;

    canvas.toBlob(blob => {
      zip.file(filename, blob);
      readySlices++;

      const url = URL.createObjectURL(blob);

      const div = document.createElement('div');
      div.className = 'chunk';

      const image = document.createElement('img');
      image.src = url;

      const label = document.createElement('div');
      label.style.textAlign = 'center';
      label.style.marginTop = '6px';
      label.style.fontSize = '14px';
      label.style.opacity = '0.7';
      label.textContent = filename;

      div.appendChild(image);
      div.appendChild(label);
      output.appendChild(div);

      // ‚úÖ –í–°–ï –ì–û–¢–û–í–´ ‚Üí –≤–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
      if (readySlices === expectedSlices) {
        downloadZipBtn.disabled = false;
      }
    }, 'image/png');

    y += sliceHeight;
    index++;
  }
}

downloadZipBtn.addEventListener('click', async () => {
  const blob = await zip.generateAsync({ type: 'blob' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = 'slices.zip';
  a.click();

  setTimeout(() => URL.revokeObjectURL(url), 1000);
});
</script>

</body>
</html>
