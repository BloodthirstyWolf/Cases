<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Horse Game MVP</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
    }

    body {
      margin: 0;
      width: 100vw;
      height: 100vh;
      background: #1e1e1e;
      color: #eaeaea;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #app {
      width: 80vw;
      max-width: 700px;
      min-height: 80vh;
      border: 1px solid #555;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    button {
      background: #333;
      color: #eaeaea;
      border: 1px solid #555;
      padding: 10px;
      cursor: pointer;
      width: 100%;
    }

    button:hover {
      background: #444;
    }

    .stall {
      padding: 6px 0;
      opacity: 0.85;
      cursor: pointer;
    }

    .stall:hover {
      text-decoration: underline;
    }

    .footer {
      margin-top: auto;
      font-size: 12px;
      opacity: 0.6;
      text-align: center;
    }
  </style>
</head>

<body>
<div id="app"></div>

<script>
  const GAME_VERSION = "0.0.1-pre";

  const appState = {
    screen: "menu", // menu | game | horse
    game: null,
    selectedHorseId: null
  };

  // ===== GAME FACTORY =====
  function createNewGame() {
    const horse = {
      id: 1,
      name: "–ë–µ–∑—ã–º—è–Ω–Ω–∞—è",
      location: "stable",
      stallId: 1
    };

    return {
      player: {
        location: "stable"
      },
      horses: {
        1: horse
      },
      stalls: {
        1: { id: 1, horseId: 1 },
        2: { id: 2, horseId: null },
        3: { id: 3, horseId: null },
        4: { id: 4, horseId: null }
      }
    };
  }

  // ===== RULE =====
  function canOpenHorseScreen(horse) {
    if (horse.location === "stable") return true;
    return horse.location === appState.game.player.location;
  }

  // ===== NAVIGATION =====
  function startNewGame() {
    appState.game = createNewGame();
    appState.screen = "game";
    render();
  }

  function openHorse(horseId) {
    appState.selectedHorseId = horseId;
    appState.screen = "horse";
    render();
  }

  function backToGame() {
    appState.screen = "game";
    appState.selectedHorseId = null;
    render();
  }

  function backToMenu() {
    appState.screen = "menu";
    appState.game = null;
    render();
  }

  function goTo(location) {
    appState.game.player.location = location;
    render();
  }

  // ===== RENDER ROOT =====
  function render() {
    const app = document.getElementById("app");
    app.innerHTML = "";

    if (appState.screen === "menu") renderMenu(app);
    if (appState.screen === "game") renderGame(app);
    if (appState.screen === "horse") renderHorse(app);
  }

  // ===== MENU =====
  function renderMenu(root) {
    root.innerHTML = `
      <h1>HORSE GAME</h1>
      <button onclick="startNewGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      <button onclick="alert('–ü—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É üôÇ')">–í—ã—Ö–æ–¥</button>
      <div class="footer">v${GAME_VERSION}</div>
    `;
  }

  // ===== GAME =====
  function renderGame(root) {
    if (appState.game.player.location === "stable") renderStable(root);
    if (appState.game.player.location === "street") renderStreet(root);
  }

  function renderStable(root) {
    root.innerHTML = "<h1>–ö–æ–Ω—é—à–Ω—è</h1>";

    Object.values(appState.game.stalls).forEach(stall => {
      const div = document.createElement("div");
      div.className = "stall";

      if (stall.horseId) {
        const horse = appState.game.horses[stall.horseId];
        div.textContent = `–°—Ç–æ–π–ª–æ ${stall.id}: ${horse.name}`;
        div.onclick = () => openHorse(horse.id);
      } else {
        div.textContent = `–°—Ç–æ–π–ª–æ ${stall.id}: –ø—É—Å—Ç–æ`;
      }

      root.appendChild(div);
    });

    const btn = document.createElement("button");
    btn.textContent = "–í—ã–π—Ç–∏ –Ω–∞ —É–ª–∏—Ü—É";
    btn.onclick = () => goTo("street");
    root.appendChild(btn);

    const back = document.createElement("button");
    back.textContent = "–í –º–µ–Ω—é";
    back.onclick = backToMenu;
    root.appendChild(back);
  }

  function renderStreet(root) {
    root.innerHTML = `
      <h1>–£–ª–∏—Ü–∞</h1>
      <div>–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ.</div>
      <button onclick="goTo('stable')">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ–Ω—é—à–Ω—é</button>
    `;
  }

  // ===== HORSE =====
  function renderHorse(root) {
    const horse = appState.game.horses[appState.selectedHorseId];

    if (!canOpenHorseScreen(horse)) {
      backToGame();
      return;
    }

    root.innerHTML = `
      <h1>–õ–æ—à–∞–¥—å</h1>
      <div>–ò–º—è: ${horse.name}</div>
      <button onclick="backToGame()">–ù–∞–∑–∞–¥</button>
    `;
  }

  render();
</script>
</body>
</html>
